{% extends "base.html" %}

{% block title %}NetTools - Главная{% endblock %}

{% block content %}
  <h1 class="mb-4">Network Tools</h1>

  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="commands-tab" data-bs-toggle="tab"
              data-bs-target="#commands" type="button" role="tab">
        Сетевые команды
      </button>
    </li>
  </ul>

  <div class="tab-content mt-3" id="myTabContent">

    <div class="tab-pane fade show active" id="commands" role="tabpanel">
      <form method="post">
        <div class="mb-3">
          <label for="host" class="form-label">Хост/IP/Домен</label>
          <input type="text" class="form-control" id="host" name="host" required>
        </div>

        <div class="mb-3">
          <label for="action" class="form-label">Действие</label>
          <select class="form-select" id="action" name="action">
            <option value="ping" {% if action == "ping" %}selected{% endif %}>Ping</option>
            <option value="traceroute" {% if action == "traceroute" %}selected{% endif %}>Traceroute</option>
            <option value="nslookup" {% if action == "nslookup" %}selected{% endif %}>Nslookup</option>
          </select>
        </div>

        <div id="ping-options" class="border rounded p-3 mb-3">
          <h5>Параметры Ping</h5>
          <div class="mb-3">
            <label for="ping_count" class="form-label">Количество пакетов</label>
            <input type="number" class="form-control" id="ping_count" name="ping_count" value="4" min="1" max="20">
          </div>
          <div class="mb-3">
            <label for="ping_timeout" class="form-label">Таймаут (сек.)</label>
            <input type="number" class="form-control" id="ping_timeout" name="ping_timeout" value="1" min="1" max="10">
          </div>
        </div>

        <div id="traceroute-options" class="border rounded p-3 mb-3 d-none">
          <h5>Параметры Traceroute</h5>
          <div class="mb-3">
            <label for="tr_max_hops" class="form-label">Макс. число hops</label>
            <input type="number" class="form-control" id="tr_max_hops" name="tr_max_hops" value="15" min="1" max="64">
          </div>
          <div class="mb-3">
            <label for="tr_queries" class="form-label">Запросов на hop</label>
            <input type="number" class="form-control" id="tr_queries" name="tr_queries" value="1" min="1" max="10">
          </div>
          <div class="mb-3">
            <label for="tr_wait" class="form-label">Таймаут ожидания (сек.)</label>
            <input type="number" class="form-control" id="tr_wait" name="tr_wait" value="2" min="1" max="10">
          </div>
        </div>

        <div id="nslookup-options" class="border rounded p-3 mb-3 d-none">
          <h5>Параметры Nslookup</h5>
          <div class="mb-3">
            <label for="ns_type" class="form-label">Тип записи</label>
            <select class="form-select" id="ns_type" name="ns_type">
              <option value="A">A (IPv4 адрес)</option>
              <option value="AAAA">AAAA (IPv6 адрес)</option>
              <option value="MX">MX (почтовые сервера)</option>
              <option value="NS">NS (DNS-сервера)</option>
              <option value="CNAME">CNAME (каноническое имя)</option>
              <option value="TXT">TXT (текстовые записи)</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="dns_server" class="form-label">DNS-сервер</label>
            <input type="text" class="form-control" id="dns_server" name="dns_server" value="8.8.8.8">
          </div>
        </div>

        <button type="submit" class="btn btn-primary">Выполнить</button>
      </form>

      {% if result %}
        <hr>
        <h3>Результат:</h3>
        {% if status == "ok" %}
          <div class="alert alert-success"><pre>{{ result }}</pre></div>
        {% elif status == "warn" %}
          <div class="alert alert-warning"><pre>{{ result }}</pre></div>
        {% elif status == "danger" %}
          <div class="alert alert-danger"><pre>{{ result }}</pre></div>
        {% else %}
          <pre class="bg-dark p-3 rounded">{{ result }}</pre>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <script>
    const actionSelect = document.getElementById("action");
    const pingOptions = document.getElementById("ping-options");
    const tracerouteOptions = document.getElementById("traceroute-options");
    const nslookupOptions = document.getElementById("nslookup-options");

    function toggleOptions() {
      pingOptions.classList.add("d-none");
      tracerouteOptions.classList.add("d-none");
      nslookupOptions.classList.add("d-none");

      if (actionSelect.value === "ping") {
        pingOptions.classList.remove("d-none");
      } else if (actionSelect.value === "traceroute") {
        tracerouteOptions.classList.remove("d-none");
      } else if (actionSelect.value === "nslookup") {
        nslookupOptions.classList.remove("d-none");
      }
    }

    actionSelect.addEventListener("change", toggleOptions);
    toggleOptions();
  </script>
{% endblock %}
